--- This patch adds debug logging to diagnose payout issue ---
--- Apply by copying the changes to server/game.ts ---

=== Add after line 168 (after user payout calculations) ===

  console.log('');
}

console.log('==================================================')

// ğŸ› DEBUG: Check if payouts were calculated
console.log(`ğŸ› DEBUG PAYOUTS: gameState.userBets.size = ${gameState.userBets.size}`);
console.log(`ğŸ› DEBUG PAYOUTS: payouts object keys = ${Object.keys(payouts).length}`);
if (Object.keys(payouts).length > 0) {
  console.log(`ğŸ› DEBUG PAYOUTS: payouts =`, payouts);
} else {
  console.warn(`âš ï¸ WARNING: No payouts calculated! payouts object is empty`);
}

=== Add after line 183 (after getBetsForGame) ===

// Get all bets for this game and categorize as winning/losing
const allBets = await storage.getBetsForGame(gameState.gameId);

// ğŸ› DEBUG: Check database bets
console.log(`ğŸ› DEBUG BETS: Retrieved ${allBets.length} bets from database for game ${gameState.gameId}`);
if (allBets.length === 0) {
  console.warn(`âš ï¸ WARNING: No bets found in database for gameId: ${gameState.gameId}`);
  console.warn(`âš ï¸ This means bets weren't saved properly OR wrong gameId is being used`);
}

=== Add after line 197 (after payoutArray is built) ===

for (const [userId, payout] of Object.entries(payouts)) {
  payoutArray.push({ userId, amount: payout, actual_payout: payout });
}

// ğŸ› DEBUG: Check payout array
console.log(`ğŸ› DEBUG PAYOUT ARRAY: payoutArray.length = ${payoutArray.length}`);
if (payoutArray.length === 0) {
  console.error(`âŒ CRITICAL: payoutArray is EMPTY! No payouts will be processed!`);
  console.error(`âŒ Diagnosis:`);
  console.error(`   - gameState.userBets.size: ${gameState.userBets.size}`);
  console.error(`   - payouts object keys: ${Object.keys(payouts).length}`);
  console.error(`   - allBets.length: ${allBets.length}`);
  console.error(`   - This indicates bets exist but payouts weren't calculated`);
} else {
  console.log(`ğŸ› DEBUG PAYOUT ARRAY: payoutArray =`, payoutArray);
}

=== After applying these changes ===

1. Save server/game.ts
2. Restart server
3. Play a complete game
4. Check console for ğŸ› DEBUG messages
5. Report back with the values shown
